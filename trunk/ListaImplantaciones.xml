<?xml version="1.0" encoding="UTF-8"?>
<Module>
	<ModulePrefs title="Url implantations"
		description=""
		author_affiliation="Capgemini">
		<Require feature="idi"/>
		<Require feature="locked-domain" />
	</ModulePrefs>
	
	<UserPref name="_table_query_url" default_value="" display_name="Data source url (Ej:https://docs.google.com/spreadsheet/ccc?key=0AoYEewut2JmZdG5HM2VLTTdwQUlLdmhnMk1DLXBWZl)" required="true" />

	<Content type="html">
		<![CDATA[

		<script src="https://www.google.com/jsapi" type="text/javascript"></script>

		<style type="text/css">			 
			
		</style>
		
					

		<div id="urlimplantation"></div>	
			
		
		<script type="text/javascript"> 
			
			
			
			var gadgetHelper = null;	
			var prefs = new _IG_Prefs(); // User preferences			
			var urlTable = prefs.getString("_table_query_url");					
			
			_IG_RegisterOnloadHandler(loadVisualizationAPI);
			
			function loadVisualizationAPI() 
			{
				google.load("visualization", "1", {"packages": ["table"]});
				google.setOnLoadCallback(sendQuery);
			}

			function sendQuery() 
			{
				gadgetHelper = new google.visualization.GadgetHelper();
				var opts = {dataType:'jsonp'};				
				var query = new google.visualization.Query(urlTable, opts);							
				var querytosend = "select O,F  where O <> ''";
				query.setQuery(querytosend);			  
				query.send(handleQueryResponse);
				
			}

			
			function handleQueryResponse(response) 
			{
				if (!gadgetHelper.validateResponse(response)) 
				{ 
					return; 
				}
			
				data = response.getDataTable();		
				
				if(data.getNumberOfRows()!=0){
				var html = "";
				html += "<ul>";
					for(var i=0; i<data.getNumberOfRows(); i++){
						
						html += '<li><a href="'+data.getValue(i,0)+'">'+data.getValue(i,1)+'</a></li>';
						
					
					}
				html +=	"</ul>";
				document.getElementById('urlimplantation') = html;
			}
		}
		</script>
		]]>
	</Content>
</Module>